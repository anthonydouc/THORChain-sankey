<html>

<head>
    <title>Thorswap Sankey</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <script src="https://kit.fontawesome.com/3793da8bd7.js" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <style>
        html {
            background-color: #22242a;
        }

        .google-visualization-tooltip {
            background-color: #22242a !important;
            border: 0px solid #22242a !important;
            -webkit-box-shadow: 0px 0px 0px 0px !important;
        }

        ul,
        li,
        p,
        strong {
            color: white !important;
        }

        select {
            color: white !important;
            background-color: #22242a !important;
        }


        .social-text {
            color: #28dcf7 !important;
            font-weight: 700;
        }

        a.social-link:link,
        :visited {
            color: #28dcf7;
        }

        a.social-link:hover {
            color: #28dcf7;
            text-decoration: underline;
        }
    </style>


    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['sankey'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var json = $.ajax({
                url: "https://api.flipsidecrypto.com/api/v2/queries/18af3d33-c935-4148-9f4f-f30c28d3dcfb/data/latest",
                dataType: "json",
                success: function (jsonData) {
                    var data = new google.visualization.DataTable();
                    var from_asset = document.getElementById("from_asset").value;
                    var direction = document.getElementById("direction").value;
                    var volume_type = document.getElementById("volume_type").value;

                    data.addColumn('string', "FROM");
                    data.addColumn('string', "TO");
                    data.addColumn('number', "WEIGHT");
                    data.addColumn({ type: 'string', role: 'tooltip' });


                    for (var i = 0; i < jsonData.length; i++) {
                        from = jsonData[i].FROM_ASSET;
                        to = jsonData[i].TO_ASSET;
                        if (volume_type == 'Total USD volume') {
                            amount = jsonData[i].AMOUNT;
                            amount_currency = Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumSignificantDigits: 12 }).format(amount)
                        }
                        else if (volume_type == 'Total RUNE volume') {
                            amount = jsonData[i].AMOUNT_RUNE;
                            amount_currency = Intl.NumberFormat('en-US', { maximumSignificantDigits: 12 }).format(amount)
                        }

                        var include = false
                        if ((direction == "Received") && (from != from_asset) && (to == from_asset)) {
                            include = true
                        }
                        else if ((direction == "Offered") && (from == from_asset) && (to != from_asset)) {
                            include = true
                        }

                        if (include == true) {
                            tooltip = '<div style="margin: 5px;"><p style=" width:150px;"><strong>' + from + '</strong> to <strong>' + to + '</strong></p><span style="color:#ffffff">' + volume_type + ': ' + amount_currency + '</span></div>';
                            data.addRow([from, to, amount, tooltip]);
                        };

                    }

                    var colors = ['#00deff', '#00deff'];

                    // Sets chart options.
                    var options = {
                        tooltip: { isHtml: true },
                        sankey: {
                            link: {
                                colorMode: 'gradient',
                                color: { stroke: '#00deff', strokeWidth: 0.05 }
                            },
                            node: {
                                width: 20,
                                nodePadding: 12,
                                label: {
                                    color: '#FFFFFF'
                                }
                            }
                        },
                    };

                    // Instantiates and draws our chart, passing in some options.
                    var chart = new google.visualization.Sankey(document.getElementById('sankey_from'));
                    chart.draw(data, options);
                }
            });
        }

    </script>
</head>

<body>
    <div class="container is-fullhd">

        <div class="block mt-2 mb-3">
            <p class="title is-2">Thorchain swap <span style="color:#28dcf7" ;>Sankey</span></p>
            <p class="subtitle is-4"><span style="color:#28dcf7" ;>An interactive tool for visualising aggregated
                    Thorchain swap
                    volume</span></p>
        </div>
        <div class="block mt-4 mb-6">
            <div class="columns">
                <div class="column is-one-fifth">
                    <p class=" ml-1 mb-2 is-title-5">Choose an asset:</p>
                    <div class="select is-rounded is-info">
                        <select style="width:200px;" id="from_asset" onchange="drawChart()">
                            <option>BNB.BNB</option>
                            <option>BCH.BCH</option>
                            <option>BTC.BTC</option>
                            <option>ETH.ETH</option>
                            <option>LTC.LTC</option>
                            <option>THOR.RUNE</option>
                            <option>BNB.AVA</option>
                            <option>BNB.BTCB</option>
                            <option>BNB.BUSD</option>
                            <option>BNB.ETH</option>
                            <option>BNB.TWT</option>
                            <option>ETH.AAVE</option>
                            <option>ETH.ALCX</option>
                            <option>ETH.DODO</option>
                            <option>ETH.HOT</option>
                            <option>ETH.KYL</option>
                            <option>ETH.PERP</option>
                            <option>ETH.SNX</option>
                            <option>ETH.SUSHI</option>
                            <option>ETH.RAZE</option>
                            <option>ETH.THOR</option>
                            <option>ETH.USDC</option>
                            <option>ETH.USDT</option>
                            <option>ETH.XRUNE</option>
                            <option>ETH.YFI</option>
                        </select>
                    </div>
                </div>
                <div class="column is-one-fifth">
                    <p class=" ml-1 mb-2 is-title-5">Choose the swap direction:</p>
                    <div class="select is-rounded is-info">
                        <select style="width:200px;" id="direction" onchange="drawChart()">
                            <option>Offered</option>
                            <option>Received</option>
                        </select>
                    </div>
                </div>
                <div class="column is-one-fifth">
                    <p class=" ml-1 mb-2 is-title-5">Choose the volume units:</p>
                    <div class="select is-rounded is-info">
                        <select style="width:200px;" id="volume_type" onchange="drawChart()">
                            <option>Total USD volume</option>
                            <option>Total RUNE volume</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="block">
            <div id="sankey_from" style="width: 85%; height: 75%;"> </div>
        </div>

        <div class="block mt-4">
            <p class="title is-4">Technical notes</p>
            <div class="content">
                <ul>
                    <li>
                        <p>Swap volume represents the total USD or RUNE value of all swaps between pairs of tokens, for all
                            data
                            available in Flipside Crypto's Thorchain swaps table.</p>
                    </li>
                    <li>
                        <p>Swaps between two tokens (excluding RUNE) involve trading the first token for RUNE, then
                            from
                            RUNE to the second token. The intermediate swap is not visualised for clarity.</p>
                    </li>
                </ul>
                <p>A JSON enpoint for the underlying data is available: <a class="social-link"
                        href="https://api.flipsidecrypto.com/api/v2/queries/18af3d33-c935-4148-9f4f-f30c28d3dcfb/data/latest"
                        target="_blank">here</a>.
                    The entire web application is publically available as <a class="social-link"
                        href="https://github.com/anthonydouc/Thorswap-sankey" target="_blank">a public github
                        repository</a>.</p>
            </div>
        </div>

        <div class="block mb-1">
            <span class="social-text">AD</span>
            <a class="social-link" href="https://stackoverflow.com/users/7583832/anthonydouc" target="_blank">
                <i class="fab fa-stack-overflow fa-lg social-link" aria-hidden="true"></i>
            </a>
            <a class="social-link" href="https://github.com/anthonydouc" target="_blank">
                <i class="fab fa-github fa-lg social-link" aria-hidden="true"></i>
            </a>
            <a class="social-link" href="https://twitter.com/AD14367367" target="_blank">
                <i class="fab fa-twitter fa-lg social-link" aria-hidden="true"></i>
            </a>
        </div>
    </div>

</body>

</html>
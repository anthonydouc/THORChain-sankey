<html>

<head>
    <title>Thorswap Sankey</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.2.0/styles/default.min.css">
    <script src="https://kit.fontawesome.com/3793da8bd7.js" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>


    <style>
        html {
            background-color: #22242a;
        }

        p {
            color: white !important;
        }

        select {
            color: white !important;
            background-color: #22242a !important;
        }
    </style>


    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['sankey'] });
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            var json = $.ajax({
                url: "https://api.flipsidecrypto.com/api/v2/queries/18af3d33-c935-4148-9f4f-f30c28d3dcfb/data/latest",
                dataType: "json",
                success: function (jsonData) {
                    var data = new google.visualization.DataTable();
                    var from_asset = document.getElementById("from_asset").value
                    data.addColumn('string', "FROM");
                    data.addColumn('string', "TO");
                    data.addColumn('number', "WEIGHT");


                    for (var i = 0; i < jsonData.length; i++) {
                        from = jsonData[i].FROM_ASSET;
                        to = jsonData[i].TO_ASSET;
                        amount = jsonData[i].AMOUNT;
                        if ((from == from_asset) && (to != from_asset)) {
                            data.addRow([from, to, amount]);
                        };

                    }

                    // Sets chart options.
                    var options = {
                        width: 900,
                        height: 700,
                        sankey: {
                            link: { color: '#2dafd9', colorMode: 'gradient' },
                            node: {
                                width: 20,
                                nodePadding: 15,
                                label: {
                                    color: '#FFFFFF'
                                }
                            }
                        },
                    };

                    // Instantiates and draws our chart, passing in some options.
                    var chart = new google.visualization.Sankey(document.getElementById('sankey_from'));
                    chart.draw(data, options);
                }
            });
        }

    </script>
</head>

<body>
    <div class="container is-fullhd">

        <div class="block mt-2 ">
            <p class="title is-2">Thorswap<span style="color:#28dcf7" ;>Sankey</span></p>
            <p class="subtitle is-4"><span style="color:#28dcf7" ;>An interactive tool to visualise aggregated ThorSwap volume.</span></p>
        </div>

        <div class="block mt-2">
            <p class=" ml-1 mb-1 is-title-5">Choose asset being offered:</p>
            <div class="select is-rounded is-primary">
                <select id="from_asset" onchange="drawChart()">
                    <option>BNB.BNB</option>
                    <option>BNB.BUSD</option>
                    <option>ETH.ETH</option>
                    <option>BNB.BTCB</option>
                </select>
            </div>
        </div>

        <div class="block">
            <div id="sankey_from" style="width: 100%; height: 100%;"> </div>
        </div>

    </div>
</body>

</html>